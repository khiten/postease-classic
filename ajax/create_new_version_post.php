<?php
 goto M9N11; n7Hat: $response = array(); goto xODcK; hO3Z_: $new_version = 0; goto smpD2; M9N11: require_once "\56\x2e\x2f\x5f\163\171\x73\164\x65\x6d\x5f\150\x65\x61\144\x65\x72\x2e\160\150\160"; goto n7Hat; smpD2: $children = array(); goto K53cW; K53cW: if (!empty($target_id) && !empty($version)) { try { $pdo->beginTransaction(); $sql = "\x53\105\114\105\103\x54\x20\166\x65\162\x73\151\x6f\x6e\40\106\122\x4f\x4d\x20{$table_prefix}\x70\x6f\x73\x74\x73\x5f\x62\141\x73\145\x20\127\x48\x45\x52\x45\40\151\x64\40\75\40{$target_id}\40\x4f\122\x44\x45\122\x20\102\x59\40\x76\x65\x72\x73\x69\x6f\156\x20\x44\x45\x53\x43\x20\114\x49\115\x49\124\40\x31\x20\117\x46\x46\123\x45\124\40\x30"; $read_last_version = $pdo->prepare($sql); $read_last_version->execute(); if ($record = $read_last_version->fetch(PDO::FETCH_ASSOC)) { $new_version = $record["\166\x65\162\163\x69\157\x6e"] + 1; unset($read_last_version); } $sql = "\x53\105\x4c\105\103\124\40\151\x64\40\106\x52\117\x4d\40{$table_prefix}\x70\157\163\x74\x73\x5f\142\141\163\x65\x20\x57\x48\x45\x52\x45\40\160\x61\162\145\156\164\x5f\151\144\x20\x3d\x20{$target_id}\40\101\116\x44\x20\143\165\x72\x72\x65\156\x74\137\146\154\x67\x20\x3d\x20\61\x20\101\116\x44\40\144\145\x6c\x65\x74\x65\137\146\x6c\147\x20\x3d\x20\x30"; $read_children = $pdo->prepare($sql); $read_children->execute(); while ($record = $read_children->fetch(PDO::FETCH_ASSOC)) { $children[] = $record["\151\144"]; } unset($read_children); if (!empty($children)) { $target_id .= "\54" . implode("\54", $children); } $sql = "\xa\x9\11\11\x9\111\x4e\123\105\122\x54\40\x49\x4e\x54\117\x20{$table_prefix}\160\x6f\x73\164\163\137\x62\x61\x73\x65\xa\x9\11\x9\11\x28\12\11\x9\11\x9\11\151\x64\x2c\40\150\x61\163\150\137\151\x64\x2c\x20\166\145\162\x73\151\157\156\54\x20\x76\145\162\x73\x69\157\x6e\x65\144\137\141\x74\54\40\143\x75\162\x72\x65\156\164\x5f\146\x6c\147\54\x20\x70\x65\162\155\x61\x6c\151\x6e\153\137\x6b\145\171\x2c\x20\x70\145\x72\x6d\x61\154\151\x6e\153\137\165\x72\x69\54\x20\160\x75\x62\x6c\151\x73\x68\137\x64\141\164\x65\x74\x69\x6d\x65\54\x20\160\165\142\x6c\x69\x73\150\137\x65\156\x64\137\141\x74\54\40\x73\x69\x74\145\137\x69\144\54\40\x70\x6f\163\164\x74\171\160\x65\x5f\x69\144\54\x20\160\x61\162\145\x6e\x74\x5f\151\144\54\x20\x63\x61\x74\145\147\157\162\x79\x5f\151\144\x2c\x20\x74\x61\147\x5f\x69\144\54\x20\x73\x6c\165\147\x2c\12\11\x9\x9\11\x9\145\171\145\x63\x61\x74\x63\x68\x2c\x20\x61\x6e\x63\150\157\162\54\40\x61\x73\x73\151\x67\x6e\145\144\x5f\x74\157\54\x20\143\x72\145\141\164\x65\144\x5f\x61\x74\x2c\40\x63\162\x65\x61\x74\145\144\x5f\x62\x79\x2c\40\165\160\144\141\x74\x65\144\x5f\141\164\x2c\x20\165\160\x64\x61\x74\x65\144\x5f\142\x79\54\40\163\164\x61\x74\x75\x73\x2c\x20\x64\x65\x6c\x65\x74\x65\137\146\154\x67\xa\11\x9\11\x9\x29\12\11\11\11\11\123\105\114\x45\x43\x54\12\x9\x9\11\11\11\x69\144\x2c\40\150\141\x73\150\x5f\x69\144\54\40{$new_version}\40\x41\123\40\166\145\162\x73\151\x6f\156\54\40\x27{$versioned_at}\x27\40\101\123\x20\x76\x65\162\163\151\157\156\145\x64\x5f\141\164\x2c\40\x30\40\x41\123\x20\x63\x75\162\x72\x65\x6e\164\x5f\x66\x6c\147\54\x20\160\145\x72\155\x61\154\x69\156\153\x5f\x6b\x65\x79\x2c\x20\160\145\x72\155\141\x6c\151\156\153\x5f\x75\162\151\x2c\x20\x70\165\142\154\151\163\150\x5f\x64\141\164\x65\164\x69\155\145\54\40\160\x75\x62\x6c\151\x73\x68\x5f\x65\x6e\x64\137\x61\x74\54\40\x73\151\x74\145\x5f\151\x64\x2c\40\x70\x6f\163\x74\x74\x79\x70\145\x5f\151\144\x2c\x20\x70\141\x72\145\156\164\137\151\x64\x2c\x20\x63\141\x74\x65\147\x6f\x72\x79\x5f\151\x64\x2c\x20\x74\x61\147\x5f\151\144\54\x20\163\x6c\x75\147\54\xa\11\x9\x9\x9\x9\145\171\x65\143\x61\164\x63\x68\x2c\x20\x61\x6e\143\x68\157\162\54\40\x61\163\x73\151\x67\x6e\x65\x64\137\x74\157\x2c\x20\143\162\x65\x61\164\x65\144\x5f\x61\x74\54\x20\x63\162\145\x61\164\145\144\137\x62\x79\x2c\x20\165\160\144\141\x74\145\x64\137\x61\164\x2c\40\x75\x70\144\141\x74\145\x64\137\142\171\54\x20\62\40\x41\123\x20\x73\164\141\164\x75\x73\x2c\40\144\145\x6c\x65\164\x65\137\x66\x6c\x67\xa\x9\x9\11\11\x46\x52\117\x4d\40{$table_prefix}\x70\157\x73\164\x73\x5f\x62\141\x73\x65\40\x57\110\105\x52\x45\x20\x69\144\x20\x49\x4e\40\x28{$target_id}\x29\40\101\116\104\40\166\145\x72\x73\151\x6f\x6e\x20\x3d\x20{$version}\xa\11\11"; $create_new_version_base = $pdo->prepare($sql); $create_new_version_base->execute(); unset($create_new_version_base); $sql = "\12\x9\11\11\x9\111\116\x53\x45\122\124\40\111\116\x54\117\40{$table_prefix}\160\x6f\x73\x74\163\x5f\164\x65\170\164\12\11\x9\11\x9\50\12\x9\11\11\11\x9\142\141\163\x65\x5f\151\144\54\40\x62\x61\x73\145\137\166\x65\162\x73\151\157\156\54\x20\154\141\x6e\147\x75\141\147\145\x5f\151\x64\54\x20\164\x69\x74\154\x65\54\40\x61\x64\144\151\164\x69\x6f\x6e\54\40\143\157\156\164\x65\156\x74\xa\x9\11\11\11\51\12\x9\11\x9\x9\123\x45\114\105\103\124\12\11\11\11\11\11\142\x61\163\145\137\151\144\54\x20{$new_version}\40\101\x53\x20\142\x61\163\x65\x5f\x76\145\162\163\x69\x6f\156\54\40\x6c\x61\x6e\x67\165\141\147\x65\137\151\x64\x2c\x20\164\151\164\154\145\x2c\40\141\144\x64\x69\164\151\157\x6e\54\x20\x63\x6f\156\x74\x65\156\164\12\11\11\x9\11\106\122\117\x4d\x20{$table_prefix}\x70\x6f\x73\164\163\137\x74\x65\x78\x74\40\x57\110\x45\x52\105\x20\x62\x61\163\145\137\x69\x64\x20\111\116\40\50{$target_id}\51\x20\101\x4e\104\x20\142\x61\163\145\137\166\x65\162\x73\x69\x6f\156\40\x3d\x20{$version}\12\11\11"; $create_new_version_text = $pdo->prepare($sql); $create_new_version_text->execute(); unset($create_new_version_text); $sql = "\12\x9\11\x9\11\111\x4e\123\x45\x52\124\x20\x49\x4e\x54\117\40{$table_prefix}\x70\x6f\163\x74\x73\x5f\x63\165\163\x74\157\x6d\12\11\x9\x9\x9\x28\xa\11\x9\11\x9\11\142\141\x73\x65\137\x69\144\54\40\x62\141\163\145\x5f\166\x65\x72\x73\151\157\x6e\x2c\40\x6c\x61\156\147\x75\x61\x67\x65\137\x69\144\54\40\x63\x75\x73\164\157\x6d\x5f\151\164\x65\x6d\x5f\x69\x64\54\x20\x76\141\154\165\145\12\11\11\11\11\x29\12\x9\x9\11\11\x53\x45\114\105\x43\x54\12\x9\11\11\x9\11\x62\x61\163\145\x5f\x69\x64\54\40{$new_version}\x20\x41\123\x20\x62\141\x73\x65\x5f\x76\x65\162\163\151\x6f\156\x2c\40\154\141\156\147\x75\141\147\x65\x5f\151\144\54\x20\143\165\163\164\157\155\137\x69\164\x65\155\x5f\151\x64\54\x20\166\141\x6c\x75\x65\12\x9\x9\11\x9\106\x52\117\x4d\x20{$table_prefix}\x70\157\x73\164\163\x5f\x63\x75\x73\164\x6f\x6d\40\127\110\x45\122\x45\40\x62\x61\163\145\x5f\x69\x64\40\x49\x4e\x20\x28{$target_id}\51\40\x41\x4e\x44\40\142\141\163\145\x5f\x76\x65\x72\x73\x69\x6f\156\40\x3d\x20{$version}\xa\11\11"; $create_new_version_custom = $pdo->prepare($sql); $create_new_version_custom->execute(); unset($create_new_version_custom); $pdo->commit(); $response["\162\x65\x73\165\154\x74"] = 1; $response["\156\145\167\x5f\x76\145\x72\x73\x69\157\x6e"] = $new_version; } catch (PDOException $e) { $pdo->rollBack(); var_dump($e->getMessage()); die; } } goto BAG1s; xODcK: $response["\x72\145\x73\165\x6c\164"] = 0; goto ZvMsa; rixvv: $versioned_at = date("\131\x2d\x6d\55\144\40\x48\72\151\72\x73"); goto hO3Z_; VeUxM: $version = !empty($_POST["\166\145\x72\163\151\x6f\156"]) ? $_POST["\166\x65\162\x73\151\x6f\156"] : 0; goto rixvv; ZvMsa: $target_id = !empty($_POST["\164\141\162\147\145\x74\137\151\x64"]) ? $_POST["\x74\141\x72\x67\x65\164\x5f\x69\x64"] : 0; goto VeUxM; BAG1s: if ($php_version < 5.2) { $json = new Jsphon(); echo $json->encode($response); } else { echo json_encode($response); }